<template>
   <div class="subheader py-2 py-lg-12 subheader-transparent" id="kt_subheader">
							<div class="container d-flex align-items-center justify-content-between flex-wrap flex-sm-nowrap">
								<div class="d-flex align-items-center flex-wrap mr-1">
									<div class="d-flex flex-column">
										<h2 class="text-white font-weight-bold my-2 mr-5">Penggajian</h2>
										<div class="d-flex align-items-center font-weight-bold my-2">
                                            
										</div>
									</div>
								</div>
							</div>
						</div>
    <div class="content d-flex flex-column flex-column-fluid" id="kt_content">
						<!--begin::Subheader-->
					
						<!--end::Subheader-->
						<!--begin::Entry-->
			<div class="d-flex flex-column-fluid">
							<!--begin::Container-->
							<div class="container mb-13">   
										<!--begin::Card-->
										<div class="card card-custom">
											<div class="card-body">
											
												<div class="container mb-14">
								<!--begin::Row-->
								<div class="row">
									<div class="col-xl-12">
										<!--begin::Nav Panel Widget 1-->
										<div class="card card-custom gutter-b">
											<!--begin::Body-->
											<div class="card-body">
												<!--begin::Nav Tabs-->
											<ul class="dashboard-tabs nav nav-pills nav-danger row row-paddingless m-0 p-0 flex-column flex-sm-row" role="tablist">
													<!--begin::Item-->
													<li class="nav-item d-flex col-sm flex-grow-1 flex-shrink-0 mr-3 mb-3 mb-lg-0">
														<a class="nav-link active border py-10 d-flex flex-grow-1 rounded flex-column align-items-center" data-toggle="pill" href="#forms_widget_tab_1">
															<span class="nav-icon py-2 w-auto">
																<span class="svg-icon svg-icon-3x">
																	<!--begin::Svg Icon | path:assets/media/svg/icons/Home/Library.svg-->
																	<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
																		<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                                        <rect x="0" y="0" width="24" height="24"/>
                                                                        <path d="M2,6 L21,6 C21.5522847,6 22,6.44771525 22,7 L22,17 C22,17.5522847 21.5522847,18 21,18 L2,18 C1.44771525,18 1,17.5522847 1,17 L1,7 C1,6.44771525 1.44771525,6 2,6 Z M11.5,16 C13.709139,16 15.5,14.209139 15.5,12 C15.5,9.790861 13.709139,8 11.5,8 C9.290861,8 7.5,9.790861 7.5,12 C7.5,14.209139 9.290861,16 11.5,16 Z" fill="#000000" opacity="0.3" transform="translate(11.500000, 12.000000) rotate(-345.000000) translate(-11.500000, -12.000000) "/>
                                                                        <path d="M2,6 L21,6 C21.5522847,6 22,6.44771525 22,7 L22,17 C22,17.5522847 21.5522847,18 21,18 L2,18 C1.44771525,18 1,17.5522847 1,17 L1,7 C1,6.44771525 1.44771525,6 2,6 Z M11.5,16 C13.709139,16 15.5,14.209139 15.5,12 C15.5,9.790861 13.709139,8 11.5,8 C9.290861,8 7.5,9.790861 7.5,12 C7.5,14.209139 9.290861,16 11.5,16 Z M11.5,14 C12.6045695,14 13.5,13.1045695 13.5,12 C13.5,10.8954305 12.6045695,10 11.5,10 C10.3954305,10 9.5,10.8954305 9.5,12 C9.5,13.1045695 10.3954305,14 11.5,14 Z" fill="#000000"/>
                                                                    </g>
																	</svg>
																	<!--end::Svg Icon-->
																</span>
															</span>
															<span class="nav-text font-size-lg py-2 font-weight-bold text-center">Pengambilan Gaji</span>
														</a>
													</li>
													<!--end::Item-->
                                                    <li class="nav-item d-flex col-sm flex-grow-1 flex-shrink-0 mr-3 mb-3 mb-lg-0">
														<a class="nav-link border py-10 d-flex flex-grow-1 rounded flex-column align-items-center" data-toggle="pill" href="#forms_widget_tab_2">
															<span class="nav-icon py-2 w-auto">
																<span class="svg-icon svg-icon-3x">
																	<!--begin::Svg Icon | path:assets/media/svg/icons/General/Shield-check.svg-->
																	<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
																		<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
																			<polygon points="0 0 24 0 24 24 0 24" />
																			<path d="M18,14 C16.3431458,14 15,12.6568542 15,11 C15,9.34314575 16.3431458,8 18,8 C19.6568542,8 21,9.34314575 21,11 C21,12.6568542 19.6568542,14 18,14 Z M9,11 C6.790861,11 5,9.209139 5,7 C5,4.790861 6.790861,3 9,3 C11.209139,3 13,4.790861 13,7 C13,9.209139 11.209139,11 9,11 Z" fill="#000000" fill-rule="nonzero" opacity="0.3" />
																			<path d="M17.6011961,15.0006174 C21.0077043,15.0378534 23.7891749,16.7601418 23.9984937,20.4 C24.0069246,20.5466056 23.9984937,21 23.4559499,21 L19.6,21 C19.6,18.7490654 18.8562935,16.6718327 17.6011961,15.0006174 Z M0.00065168429,20.1992055 C0.388258525,15.4265159 4.26191235,13 8.98334134,13 C13.7712164,13 17.7048837,15.2931929 17.9979143,20.2 C18.0095879,20.3954741 17.9979143,21 17.2466999,21 C13.541124,21 8.03472472,21 0.727502227,21 C0.476712155,21 -0.0204617505,20.45918 0.00065168429,20.1992055 Z" fill="#000000" fill-rule="nonzero" />
																		</g>
																	</svg>
																	<!--end::Svg Icon-->
																</span>
															</span>
															<span class="nav-text font-size-lg py-2 font-weight-bolder text-center">Cetak dan Riwayat Gaji</span>
														</a>
													</li>
													<!--end::Item-->
													<!--begin::Item-->
													<!--end::Item-->
												</ul>
												<!--end::Nav Tabs-->
												<!--begin::Nav Content-->
												<div class="tab-content m-0 p-0">
												</div>
												<!--end::Nav Content-->
											</div>
											<!--end::Body-->
										</div>
                                        
										<!--begin::Nav Panel Widget 1-->
									</div>
                                    
								</div>
                                <div class="tab-content">
                                    <div class="card card-custom tab-pane show active" id="forms_widget_tab_1" role="tabpanel">
											<!--begin::Header-->
											<div class="card-header flex-wrap border-0 pt-6 pb-0">
												<h3 class="card-title align-items-start flex-column">
													<span class="card-label font-weight-bolder text-dark" >Ambil Gaji</span>
                                                    <span class="text-muted mt-1 font-weight-bold font-size-sm" v-for="(data) in infopt" :key="data.id">Data Penggajian Karyawan di {{ data.nama_perusahaan }} </span>
												</h3>
											</div>
											<!--end::Header-->
											<!--begin::Body-->
											<div class="card-body">
                                                <div class="table-responsive">
													<table class="table table-head-custom table-vertical-center" id="kt_advance_table_widget_1">
                                                        <thead class="" >
                                                        <tr>
                                                            <th>No</th>
                                                            <th>Periode/Tanggal</th>
                                                            <th>Jabatan</th>
                                                            <th>Total Gaji</th>
                                                            <th style="text-align:center;">Status</th>
															<th style="text-align: center;">Detail Gaji</th>
                                                            <th style="text-align: center;">Action</th>
                                                        </tr>
                                                        </thead>
                                                         <tbody v-for="(data,index) in gajipeg" :key="data.id">
                                                            <tr v-if="data.status == 'Belum Diambil'">
                                                                    <td>{{index+1}} </td>
                                                                    <td>{{ data.tanggal }}</td>
                                                                    <td>
																		 <span v-for="jab in jabatan" :key="jab.id">
                                                                            <a v-if="data.id_jabatan == jab.id">{{jab.jabatan}}</a>
                                                                        </span>
																	</td>
																	 <td>
																		  <span v-for="has in data.akhir" :key="has.id">
                                                                            <a>{{convertToRupiah(has)}}</a>
                                                                        </span>
																	</td>
                                                                    <td style="text-align:center">
                                                                         <span v-if="data.status == 'Belum Diambil'" class="badge badge-warning" style="color:white" >Belum Diambil</span>
                                                                         <span v-if="data.status == 'Sudah Diambil'" class="badge badge-success" style="color:white" >Sudah Diambil</span>
                                                                    </td>
                                                                     <td style="text-align: center;">
                                                                         <span @click.prevent="detGaji(data.id)" class="badge badge-primary" style="cursor:pointer" >Detail</span>
                                                                    </td>
                                                                    <td style="text-align: center;">
                                                                         <span v-if="data.status == 'Belum Diambil'" @click.prevent="modalconfirm(data)" class="badge badge-warning" style="cursor:pointer; color:white" >Ambil</span>
                                                                           <span v-else-if="data.status == 'Sudah Diambil'" class="badge badge-success">Sudah Diambil</span>
																		  <!-- <span v-else-if="data.status == 'Sudah Diambil'" @click.prevent="showinvoice(data.id)" class="badge badge-success" style="cursor:pointer" >Cetak</span> -->
                                                                    </td>
                                                            </tr>
                                                        </tbody>
                                                         <tbody v-for="(data,index) in riwayatgaji" :key="data.id">
                                                            <tr v-if="data.status == 'Sudah Diambil'">
                                                                    <td>{{ index+1}} </td>
                                                                    <td>
                                                                        {{ data.tanggal_ambil}}
                                                                    </td>
                                                                    <td> <span v-for="jab in jabatan" :key="jab.id">
                                                                            <a v-if="data.id_jabatan == jab.id">{{jab.jabatan}}</a>
                                                                        </span>
                                                                    </td>
                                                                     <td>
                                                                        {{convertToRupiah(data.gaji_bersih)}}
                                                                    </td>
                                                                     <td style="text-align:center">
                                                                         <span v-if="data.status == 'Belum Diambil'" class="badge badge-warning" style="color:white" >Belum Diambil</span>
                                                                         <span v-if="data.status == 'Sudah Diambil'" class="badge badge-success" style="color:white" >Sudah Diambil</span>
                                                                    </td>
                                                                   <td style="text-align: center;">
                                                                           <span @click.prevent="getriwayatdetail(data.id)" class="badge badge-primary" style="cursor:pointer">Detail</span>
                                                                    </td>
                                                                    <td style="text-align: center;">
                                                                            <span @click.prevent="showinvoice(data.id)" class="badge badge-info" style="cursor:pointer">Cetak</span>
                                                                         
                                                                    </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>

                                                </div>
												<!--end::Datatable-->
											</div>
											<!--end::Body-->
										</div>
                                          <div class="card card-custom tab-pane show" id="forms_widget_tab_2" role="tabpanel">
											<!--begin::Header-->
											<div class="card-header flex-wrap border-0 pt-6 pb-0">
												<h3 class="card-title align-items-start flex-column">
													<span class="card-label font-weight-bolder text-dark" >Riwayat Penggajian Pegawai</span>
                                                    <span class="text-muted mt-1 font-weight-bold font-size-sm" v-for="(data) in infopt" :key="data.id">Data Riwayat Penggajian Karyawan di {{ data.nama_perusahaan }} </span>
												</h3>
												
											</div>
											<!--end::Header-->
											<!--begin::Body-->
											<div class="card-body">
												<!--begin::Search Form-->
												<!--begin::Search Form-->
												<div class="mb-10">
													<div class="row align-items-center">
														<div class="col-lg-12 col-xl-8">
															 <form>
															<div class="row align-items-center">
																<div class="col-md-4 my-2 my-md-0">
																	<div class="input-icon">
																		<input v-model="search" type="text" class="form-control form-control-solid" placeholder="Cari Berdasarkan Tanggal"  />
																		<span>
																			<i class="flaticon2-search-1 text-muted"></i>
																		</span>
																	</div>
																</div>
																<div>
																	<div>
																	<a class="btn btn-light-primary px-6 font-weight-bold">Search</a>
																</div>
																</div>
															</div>
														  </form>
														</div>
													</div>
												</div>
												<!--end::Search Form-->
												<!--end: Search Form-->
												<!--begin::Datatable-->
												<div class="table-responsive">
													<table class="table table-head-custom table-vertical-center" id="kt_advance_table_widget_1 w-200">
                                                        <thead class="" >
                                                        <tr>
                                                            <th>No</th>
                                                            <th>Email</th>
                                                            <th>Periode</th>
                                                            <th>Jabatan</th>
                                                            <th>Total Gaji</th>
                                                            <th style="text-align: center;">Status</th>
                                                            <th style="text-align: center;">Action</th>
                                                        </tr>
                                                        </thead>
                                                         <tbody v-for="(data,index) in riwayatgaji.data" :key="data.id">
                                                            <tr v-if="data.status == 'Sudah Diambil'">
                                                                    <td>{{ index+1}} </td>
                                                                    <td>{{ data.email }}</td>
                                                                    <td>
                                                                        {{ data.tanggal_ambil}}
                                                                    </td>
                                                                    <td> <span v-for="jab in jabatan" :key="jab.id">
                                                                            <a v-if="data.id_jabatan == jab.id">{{jab.jabatan}}</a>
                                                                        </span>
                                                                    </td>
                                                                     <td>
                                                                        {{convertToRupiah(data.gaji_bersih)}}
                                                                    </td>
                                                                    <td  style="text-align: center;">
                                                                         <span class="badge badge-success" >Sudah Diambil</span>
                                                                    </td>
                                                                    <td style="text-align: center;">
                                                                           <span @click.prevent="getriwayatdetail(data.id)" class="badge badge-primary" style="cursor:pointer">Detail</span>
                                                                            <span @click.prevent="showinvoice(data.id)" class="badge badge-info ml-3" style="cursor:pointer">Cetak</span>
                                                                         
                                                                    </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>

                                                </div>
                                                <Pagination align="right" :data="riwayatgaji" @pagination-change-page="riwayat" />
												<!--end::Datatable-->
											</div>
											<!--end::Body-->
										</div>
                                </div>
                                
							</div>
                            
												<!--end::Datatable-->
											</div>
											<!--end::Body-->
										</div>
										<!--end::Card-->
									</div>
									<!--end::Content-->
								</div>
								<!--end::Teachers-->
							</div>
											<!--end::Body-->
                              

							<div id="printThis">
								<div class="modal fade" id="invoicegaji" tabindex="-1" role="dialog" aria-labelledby="staticBackdrop" aria-hidden="true">
															<div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-xl" role="document">
																<div class="modal-content">
																	<div class="modal-header">
                                                                        <h5 class="modal-title" id="invoicegaji">Slip Penggajian</h5>
																		<button type="button" class="close" data-dismiss="modal" aria-label="Close">
																			<i aria-hidden="true" class="ki ki-close" @click="closeinvoice()"></i>
																		</button>
																	</div>
																	<div class="modal-body" >
																	<div class="card-body p-0">
										<!-- begin: Invoice-->
										<!-- begin: Invoice header-->
										<div class="row justify-content-center py-8 px-8">
											<div class="col-md-9">
												<div class="d-flex justify-content-between pb-10 pb-md-20 flex-column flex-md-row">
													<h1 class="display-4 font-weight-boldest mb-10">SLIP GAJI</h1>
													<div class="d-flex flex-column align-items-md-end px-0" v-for="(data) in infopt" :key="data.id">
														<!--begin::Logo-->
														<h3 style="font-weight:bolder" href="#" class="mb-5" >
															{{data.nama_perusahaan}}
														</h3>
														<!--end::Logo-->
														<span class="text-right">
															<span>{{data.det_alamat}}</span>
														</span>
													</div>
												</div>
												<div class="border-bottom w-100"></div>
												<div class="d-flex justify-content-between pt-6" v-for="(data) in pegawais" :key="data.id">
													<div class="d-flex flex-column flex-root">
														<span class="font-weight-bolder mb-2">PEGAWAI</span>
														<span class="opacity-70">{{data.nama_lengkap}}</span>
													</div>
													<div class="d-flex flex-column flex-root"  v-for="(data) in invgaji" :key="data.id">
														<span class="font-weight-bolder mb-2">PERIODE GAJI</span>
														<span class="opacity-70">{{data.tanggal}}</span>
													</div>
													<div class="d-flex flex-column flex-root">
														<span class="font-weight-bolder mb-2 text-right">ALAMAT PEGAWAI</span>
														<span class="opacity-70 text-right">{{data.alamat}}</span>
													</div>
												</div>
											</div>
										</div>
										<!-- end: Invoice header-->
										<!-- begin: Invoice body-->
										<div class="row justify-content-center py-8 px-8 py-md-10 px-md-0">
											<div class="col-md-9">
												<div class="table-responsive">
													<table class="table table-bordered"  v-for="(data) in detriwayat" :key="data.id">
                                                        <thead class="" >
                                                        
                                                        <tr>
                                                            <th>Jenis</th>
                                                            <th class="text-right">Nominal</th>
                                                        </tr>
                                                        </thead>
                                                        <tr>
                                                            <td>Gaji Pokok</td>
                                                             <td class="text-right">{{convertToRupiah(data.gaji_pokok)}}</td>
                                                        </tr>
                                                         <tr>
                                                           <td>
                                                                     <span v-for="x in data.detritun" :key="x.id">
                                                                            <li style="list-style:none;">{{x}}</li>
                                                                        </span>
                                                                </td> 
                                                                <td class="text-right">
                                                                 <span v-for="x in data.detrinomtun" :key="x.id">
                                                                            <li style="list-style:none;">{{convertToRupiah(x)}}</li>
                                                                        </span>
                                                                </td> 
                                                        </tr>
                                                        <tr>
                                                             <td>
                                                                     <span v-for="x in data.detribon" :key="x.id">
                                                                            <li style="list-style:none;">{{x}}</li>
                                                                        </span>
                                                                </td> 
                                                        
                                                                <td class="text-right">
                                                                      <span v-for="x in data.detrinombon" :key="x.id">
                                                                            <li style="list-style:none;">{{convertToRupiah(x)}}</li>
                                                                        </span>
                                                                </td> 
                                                        </tr>
                                                       
                                                        <thead class="" >
                                                        <tr>
                                                            <th>Gaji Kotor</th>
                                                             <th class="text-right">{{convertToRupiah(data.gaji_kotor)}}</th>
                                                        </tr>
                                                        </thead>
                                                        <tr>
                                                             <td>
                                                                     <span v-for="x in data.detripot" :key="x.id">
                                                                            <li style="list-style:none;">{{x}}</li>
                                                                        </span>
                                                                </td> 
                                                                <td class="text-right">
                                                                      <span v-for="x in data.detrinompot" :key="x.id">
                                                                            <li style="list-style:none;">{{convertToRupiah(x)}}</li>
                                                                        </span>
                                                                </td> 
                                                        </tr>
                                                            
                                                        
                                                         <thead class="" >
                                                        <tr>
                                                            <th>Total Potongan</th>
                                                            <th class="text-right">
                                                                     <span>
                                                                            <a>(-) {{convertToRupiah(data.total_potongan)}}</a>
                                                                        </span>
                                                            </th> 
                                                        </tr>
                                                        </thead>
                                                         <thead class="" >
                                                        <tr>
                                                            <th>Penerima Bersih</th>
                                                            <th class="text-right">
                                                                <a>{{convertToRupiah(data.gaji_bersih)}}</a>
                                                            </th>
                                                        </tr>
                                                        </thead>
                                                         <tbody>
                                                        </tbody>
                                                    </table>
												</div>
											</div>
										</div>
										<!-- end: Invoice body-->
										<!-- begin: Invoice footer-->
										<div class="row justify-content-center bg-gray-100 py-8 px-8 py-md-10 px-md-0">
											<div class="col-md-9">
												<div class="table-responsive">
													<table class="table" v-for="(data) in detriwayat" :key="data.id">
														<thead>
															<tr>
																<th class="font-weight-bold text-muted text-uppercase"></th>
																<th class="font-weight-bold text-muted text-uppercase"></th>
																<th class="font-weight-bold text-muted text-uppercase"></th>
																<th class="font-weight-bold text-muted text-uppercase text-right">TOTAL PENDAPATAN BERSIH</th>
															</tr>
														</thead>
														<tbody>
															<tr class="font-weight-bolder" >
																<td></td>
																<td></td>
																<td></td>
																<td class="text-danger font-size-h3 font-weight-boldest text-right">{{convertToRupiah(data.gaji_bersih)}}</td>
															</tr>
														</tbody>
													</table>
												</div>
											</div>
										</div>
										<!-- end: Invoice footer-->
										<!-- begin: Invoice action-->
										<div class="row justify-content-center py-8 px-8 py-md-10 px-md-0">
											<div class="col-md-9">
												<div class="d-flex justify-content-between">
													<button type="button" id="btnPrint" class="btn btn-light-primary font-weight-bold">Cetak Slip Gaji</button>
												</div>
											</div>
										</div>
										<!-- end: Invoice action-->
										<!-- end: Invoice-->
									</div>
																	</div>
																</div>
															</div>
														</div>       				
							</div>
			
<div class="modal fade" id="detailgajipegawai" tabindex="-1" role="dialog" aria-labelledby="staticBackdrop" aria-hidden="true">
															<div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-md" role="document">
																<div class="modal-content">
																	<div class="modal-header">
                                                                        <h5 class="modal-title" id="detailgajipegawai">Detail Gaji Pegawai</h5>
																		<button type="button" class="close" data-dismiss="modal" aria-label="Close">
																			<i aria-hidden="true" class="ki ki-close" @click="closeDetGaji()"></i>
																		</button>
																	</div>
																	<div class="modal-body">
                                                                        <h5 class="modal-title" id="detailgajipegawai" v-for="(data) in detailgajipeg" :key="data.id">Detail Penggajian <a style="font-weight:bolder">{{data.email}}</a></h5>
                                                                        <br>
																		<div class="table-responsive">
													<table class="table table-bordered"  v-for="(data) in detailgajipeg" :key="data.id">
                                                        <thead class="" >
                                                        
                                                        <tr>
                                                            <th>Jenis</th>
                                                            <th class="text-right">Nominal</th>
                                                        </tr>
                                                        </thead>
                                                        <tr>
                                                            <td>Gaji Pokok</td>
                                                             <td class="text-right" v-for="jabgaji in data.totjab" :key="jabgaji.id">{{convertToRupiah(jabgaji)}}</td>
                                                        </tr>
                                                         <tr>
                                                           <td>
                                                                     <span v-for="tundet in data.dettun" :key="tundet.id">
                                                                            <li style="list-style:none;">{{tundet}}</li>
                                                                        </span>
                                                                </td> 
                                                                <td class="text-right">
                                                                     <span v-for="nomtun in data.nomdettun" :key="nomtun.id">
                                                                            <li style="list-style:none">{{convertToRupiah(nomtun)}}</li>
                                                                        </span>
                                                                </td> 
                                                        </tr>
                                                        <tr>
                                                             <td>
                                                                     <span v-for="bondet in data.detbon" :key="bondet.id">
                                                                            <li style="list-style:none;">{{bondet}}</li>
                                                                        </span>
                                                                </td> 
                                                        
                                                                <td class="text-right">
                                                                     <span v-for="nomibon in data.nombon" :key="nomibon.id">
                                                                            <li style="list-style:none">{{convertToRupiah(nomibon)}}</li>
                                                                        </span>
                                                                </td> 
                                                        </tr>
                                                       
                                                        <thead class="" >
                                                        <tr>
                                                            <th>Sub Total</th>
                                                             <th class="text-right" v-for="sub in data.subsub" :key="sub.id">{{convertToRupiah(sub)}}</th>
                                                        </tr>
                                                        </thead>
                                                        <tr>
                                                             <td>
                                                                     <span v-for="potdet in data.detpot" :key="potdet.id">
                                                                            <li style="list-style:none;">{{potdet}}</li>
                                                                        </span>
                                                                </td> 
                                                                <td class="text-right">
                                                                     <span v-for="nomipot in data.nompot" :key="nomipot.id">
                                                                            <li style="list-style:none">{{convertToRupiah(nomipot)}}</li>
                                                                        </span>
                                                                </td> 
                                                        </tr>
                                                            
                                                        
                                                         <thead class="" >
                                                        <tr>
                                                            <th>Total Potongan</th>
                                                            <th class="text-right">
                                                                     <span v-for="totapot in data.totpot" :key="totapot.id">
                                                                            <a>(-) {{convertToRupiah(totapot)}}</a>
                                                                        </span>
                                                            </th> 
                                                        </tr>
                                                        </thead>
                                                         <thead class="" >
                                                        <tr>
                                                            <th>Penerima Bersih</th>
                                                            <th class="text-right" v-for="totagaj in data.totalgaji" :key="totagaj.id">
                                                                <a>{{convertToRupiah(totagaj)}}</a>
                                                            </th>
                                                        </tr>
                                                        </thead>
                                                         <tbody>
                                                        </tbody>
                                                    </table>

                                                </div>
																	</div>
																	<div class="modal-footer">
                                                                        <button type="button"  data-dismiss="modal" @click="closeDetGaji()" class="btn btn-primary font-weight-bold">Tutup</button>
																	</div>
																</div>
															</div>
														</div>   
<div class="modal fade" id="confirm" tabindex="-1" role="dialog" aria-labelledby="staticBackdrop" aria-hidden="true">
															<div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-md" role="document">
																<div class="modal-content text-center">
																	<div class="modal-header">
																		<h5 class="modal-title" id="editPegawai">Ambil Gaji</h5>
																		<button type="button" class="close" data-dismiss="modal" aria-label="Close">
																			<i aria-hidden="true" class="ki ki-close" @click="closeconfirm()"></i>
																		</button>
																	</div>
																	<div class="modal-body">
																		<div style="padding:22px" >
																			<h3>Apakah Anda Ingin Ambil Gaji Sekarang ?</h3> 
																			<span style="color:red">Pastikan Detail Gaji Sudah Sesuai !</span>
																		</div>
																	</div>
																	<div class="modal-footer">
																		
																		<button type="submit" @click="ambil()"  class="btn btn-primary font-weight-bold">Ambil Sekarang</button>
                                                                        <button type="button"  data-dismiss="modal" @click="closeconfirm()" class="btn btn-danger font-weight-bold">Nanti</button>
																	</div>
																</div>
															</div>
														</div>    	
<div class="modal fade" id="detriwayat" tabindex="-1" role="dialog" aria-labelledby="staticBackdrop" aria-hidden="true">
															<div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-md" role="document">
																<div class="modal-content">
																	<div class="modal-header">
                                                                        <h5 class="modal-title" id="detriwayat">Detail Gaji Pegawai</h5>
																		<button type="button" class="close" data-dismiss="modal" aria-label="Close">
																			<i aria-hidden="true" class="ki ki-close" @click="closeriwayat()"></i>
																		</button>
																	</div>
																	<div class="modal-body">
                                                                        <h5 class="modal-title" id="detriwayat" v-for="(data) in detriwayat" :key="data.id">Detail Penggajian <a style="font-weight:bolder">{{data.email}}</a></h5>
                                                                        <br>
																		<div class="table-responsive">
													<table class="table table-bordered"  v-for="(data) in detriwayat" :key="data.id">
                                                        <thead class="" >
                                                        
                                                        <tr>
                                                            <th>Jenis</th>
                                                            <th class="text-right">Nominal</th>
                                                        </tr>
                                                        </thead>
                                                        <tr>
                                                            <td>Gaji Pokok</td>
                                                             <td class="text-right">{{convertToRupiah(data.gaji_pokok)}}</td>
                                                        </tr>
                                                         <tr>
                                                           <td>
                                                                     <span v-for="x in data.detritun" :key="x.id">
                                                                            <li style="list-style:none;">{{x}}</li>
                                                                        </span>
                                                                </td> 
                                                                <td class="text-right">
                                                                 <span v-for="x in data.detrinomtun" :key="x.id">
                                                                            <li style="list-style:none;">{{convertToRupiah(x)}}</li>
                                                                        </span>
                                                                </td> 
                                                        </tr>
                                                        <tr>
                                                             <td>
                                                                     <span v-for="x in data.detribon" :key="x.id">
                                                                            <li style="list-style:none;">{{x}}</li>
                                                                        </span>
                                                                </td> 
                                                        
                                                                <td class="text-right">
                                                                      <span v-for="x in data.detrinombon" :key="x.id">
                                                                            <li style="list-style:none;">{{convertToRupiah(x)}}</li>
                                                                        </span>
                                                                </td> 
                                                        </tr>
                                                       
                                                        <thead class="" >
                                                        <tr>
                                                            <th>Sub Total</th>
                                                             <th class="text-right">{{convertToRupiah(data.gaji_kotor)}}</th>
                                                        </tr>
                                                        </thead>
                                                        <tr>
                                                             <td>
                                                                     <span v-for="x in data.detripot" :key="x.id">
                                                                            <li style="list-style:none;">{{x}}</li>
                                                                        </span>
                                                                </td> 
                                                                <td class="text-right">
                                                                      <span v-for="x in data.detrinompot" :key="x.id">
                                                                            <li style="list-style:none;">{{convertToRupiah(x)}}</li>
                                                                        </span>
                                                                </td> 
                                                        </tr>
                                                            
                                                        
                                                         <thead class="" >
                                                        <tr>
                                                            <th>Total Potongan</th>
                                                            <th class="text-right">
                                                                     <span>
                                                                            <a>(-) {{convertToRupiah(data.total_potongan)}}</a>
                                                                        </span>
                                                            </th> 
                                                        </tr>
                                                        </thead>
                                                         <thead class="" >
                                                        <tr>
                                                            <th>Penerima Bersih</th>
                                                            <th class="text-right">
                                                                <a>{{convertToRupiah(data.gaji_bersih)}}</a>
                                                            </th>
                                                        </tr>
                                                        </thead>
                                                         <tbody>
                                                        </tbody>
                                                    </table>

                                                </div>
																	</div>
																	<div class="modal-footer">
                                                                        <button type="button"  data-dismiss="modal" @click="closeriwayat()" class="btn btn-primary font-weight-bold">Tutup</button>
																	</div>
																</div>
															</div>
														</div>     						


</template>


<script>

export default {
    name: "Penggajian",
    data() {
        return {
			form: new Form ({
				id: "",
                status : ""
            }),
            search:'',
            detritun: [],
            detrinomtun: [],
            detribon: [],
            detrinombon: [],
            detripot: [],
            detrinompot: [],
            detriwayat:[],
            riwayatgaji: [],
            subsub: [],
			jabat: [],
			invgaji: [],
			totjab: [],
            totalgaji: [],
            detpot: [],
            nompot: [],
            totpot: [],
            detbon: [],
            nombon: [],
            totbon: [],
            dettun : [],
            totun : [],
            nomdettun : [],
            akhir: [],
            nilai:[],
            bon: [],
            potong: [],
			gajipeg: [],
			detailgajipeg: [],
			infopt: [],
			jabatan: [],
			akunpegawai: [],
			pegawais: [],
            token: localStorage.getItem("token"),
            role: localStorage.getItem('role'),
        }
    },
	methods: {
		convertToRupiah(value) {
            // value = value.toString()
            value = parseFloat(value)
            let rupiah = ''
            let valueRev = value.toString().split('').reverse().join('')
            for (let i = 0; i < valueRev.length; i++) {
                if (i % 3 === 0) rupiah += `${valueRev.substr(i, 3)}.`
            }

            const rp = rupiah
                .split('', rupiah.length - 1)
                .reverse()
                .join('')
            // console.log('rupiah', isNaN(rp), rupiah.length, rp, rupiah)
            if (rupiah === 'NaN.' || rupiah === 'NaN') {
                return '...'
            }
            return `Rp ${rp}`
        },
		 getprofile(){
            this.$axios.get('/sanctum/csrf-cookie').then(response => {
            this.$axios.get('/api/getprofile',{
                headers: {Authorization: "Bearer " + this.token},
            })
                .then(response => {
                    this.pegawais = response.data.data;
                })
                .catch(function (error) {
                    console.error(error);
                });
        })
        },
		closeconfirm() {
            this.form.reset();
            $("#confirm").modal("hide");
        },
        modalconfirm(data) {
            // this.form.reset()
            $("#confirm").modal("show")
            this.form.fill({
                id: data.id,
                status: data.status,
            })
        },
        riwayat(page = 1){
            this.$axios.get('/sanctum/csrf-cookie').then(response => {
            this.$axios.get('/api/riwayatgajipeg?page=' + page,{
                headers: {Authorization: "Bearer " + this.token},
            })
                .then(response => {
                    this.riwayatgaji = response.data.data;
                })
                .catch(function (error) {
                    console.error(error);
                });
        })
        },
        getakun(){
            this.$axios.get('/sanctum/csrf-cookie').then(response => {
            this.$axios.get('/api/getakun',{
                headers: {Authorization: "Bearer " + this.token},
            })
                .then(response => {
                    this.akunpegawai = response.data.data;
                })
                .catch(function (error) {
                    console.error(error);
                });
        })
        },
        getJabatan(){
            this.$axios.get('/sanctum/csrf-cookie').then(response => {
            this.$axios.get('/api/jabatanpegawai',{
                headers: {Authorization: "Bearer " + this.token},
            })
                .then(response => {
                    this.jabatan = response.data.data;
                })
                .catch(function (error) {
                    console.error(error);
                });
        })
        },
		ambil(){
			  axios.post('/api/ambilgaji',
                {
                    id: this.form.id,
                    status: "Sudah Diambil"
                },
                {
                    headers: { Authorization: "Bearer " + this.token }
                }).then((response) => {
                if (response.data.success){
                    Swal.fire({
                        icon: "success",
                        title: "Berhasil",
                        text: "Gaji Berhasil Diambil !",
                        showConfirmButton: false,
                        timer: 2000,
                    }),
					$("#confirm").modal("hide");
                    this.getgaji();
                    this.riwayat();
                }
            })
            	
        },
		getpt(){
            this.$axios.get('/sanctum/csrf-cookie').then(response => {
            this.$axios.get('/api/infoptpeg',{
                headers: {Authorization: "Bearer " + this.token},
            })
                .then(response => {
                    this.infopt = response.data.data;
                })
                .catch(function (error) {
                    console.error(error);
                });
        })
        },
		getgaji(){
            this.$axios.get('/sanctum/csrf-cookie').then(response => {
            this.$axios.get('/api/gajipegawai',{
                headers: {Authorization: "Bearer " + this.token},
            })
                .then(response => {
                    this.gajipeg = response.data.data;
					this.nilai = response.data.tunjangan;
                    this.bon = response.data.bonus;
                    this.potong = response.data.potongan;
                    this.akhir = response.data.hasil;
					this.jabat = response.data.jabatan;

                    for (let i = 0; i < this.nilai.length; i++) {
                        Object.assign(this.gajipeg[i], { nilai: this.nilai[i] })
                    }
                    for (let i = 0; i < this.bon.length; i++) {
                        Object.assign(this.gajipeg[i], { bon: this.bon[i] })
                    }
                    for (let i = 0; i < this.potong.length; i++) {
                        Object.assign(this.gajipeg[i], { potong: this.potong[i] })
                    }
                    for (let i = 0; i < this.akhir.length; i++) {
                        Object.assign(this.gajipeg[i], { akhir: this.akhir[i] })
                    }
					for (let i = 0; i < this.jabat.length; i++) {
                        Object.assign(this.gajipeg[i], { jabat: this.jabat[i] })
                    }
                })
                .catch(function (error) {
                    console.error(error);
                });
        })
        },
		closeDetGaji(){
            $("#detailgajipegawai").modal("hide");
		},
		showinvoice(id){
            $("#invoicegaji").modal("show");
			 axios.get('/api/detriwayatgaji/'+id,{
                headers: { Authorization: "Bearer " + this.token }
            }).then((response) => {
                this.detriwayat = response.data.data
                //ssds
                this.detritun = response.data.tunjangan
                this.detrinomtun = response.data.nomtun
                this.detribon = response.data.bonus
                this.detrinombon = response.data.nombon
                this.detripot = response.data.potongan
                this.detrinompot = response.data.nompot

                    for (let i = 0; i < this.detritun.length; i++) {
                        Object.assign(this.detriwayat[i], { detritun: this.detritun[i] })
                    }   
                    for (let i = 0; i < this.detrinomtun.length; i++) {
                        Object.assign(this.detriwayat[i], { detrinomtun: this.detrinomtun[i] })
                    }
                    for (let i = 0; i < this.detribon.length; i++) {
                        Object.assign(this.detriwayat[i], { detribon: this.detribon[i] })
                    }   
                    for (let i = 0; i < this.detrinombon.length; i++) {
                        Object.assign(this.detriwayat[i], { detrinombon: this.detrinombon[i] })
                    }    
                    for (let i = 0; i < this.detripot.length; i++) {
                        Object.assign(this.detriwayat[i], { detripot: this.detripot[i] })
                    }   
                    for (let i = 0; i < this.detrinompot.length; i++) {
                        Object.assign(this.detriwayat[i], { detrinompot: this.detrinompot[i] })
                    }        
            })
		},
		closeinvoice(){
            $("#invoicegaji").modal("hide");
		},
		detGaji(id){
            $('#detailgajipegawai').modal('show')
            axios.get('/api/detgajipeg/'+id,{
                headers: { Authorization: "Bearer " + this.token }
            }).then((response) => {
                this.detailgajipeg = response.data.data
                //TUNJANGAN
                this.dettun = response.data.tunjangan;
                this.nomdettun = response.data.nominal;
                this.totun = response.data.arrtun;
                //BONUS
                this.detbon = response.data.bonus;
                this.nombon = response.data.nominal_bonus;
                this.totbon = response.data.arrbon;
                //POTONGAN
                this.detpot = response.data.potongan;
                this.nompot = response.data.nominal_potongan;
                this.totpot = response.data.arrpot;
                //TOTAL GAJI
                this.totalgaji = response.data.hasil;
                this.totjab = response.data.arrjab;

                this.subsub = response.data.subtotal;
                //TUNJANGAN
                for (let i = 0; i < this.dettun.length; i++) {
                        Object.assign(this.detailgajipeg[i], { dettun: this.dettun[i] })
                    }
                for (let i = 0; i < this.nomdettun.length; i++) {
                        Object.assign(this.detailgajipeg[i], { nomdettun: this.nomdettun[i] })
                    }
                for (let i = 0; i < this.totun.length; i++) {
                        Object.assign(this.detailgajipeg[i], { totun: this.totun[i] })
                    }    
                //BONUS
                for (let i = 0; i < this.detbon.length; i++) {
                        Object.assign(this.detailgajipeg[i], { detbon: this.detbon[i] })
                    }
                for (let i = 0; i < this.nombon.length; i++) {
                        Object.assign(this.detailgajipeg[i], { nombon: this.nombon[i] })
                    }
                for (let i = 0; i < this.totbon.length; i++) {
                        Object.assign(this.detailgajipeg[i], { totbon: this.totbon[i] })
                    }    
                //POTONGAN
                for (let i = 0; i < this.detpot.length; i++) {
                        Object.assign(this.detailgajipeg[i], { detpot: this.detpot[i] })
                    }
                for (let i = 0; i < this.nompot.length; i++) {
                        Object.assign(this.detailgajipeg[i], { nompot: this.nompot[i] })
                    }
                for (let i = 0; i < this.totpot.length; i++) {
                        Object.assign(this.detailgajipeg[i], { totpot: this.totpot[i] })
                    }
                //TOTAL GAJI
                for (let i = 0; i < this.totalgaji.length; i++) {
                        Object.assign(this.detailgajipeg[i], { totalgaji: this.totalgaji[i] })
                    }
                for (let i = 0; i < this.totjab.length; i++) {
                        Object.assign(this.detailgajipeg[i], { totjab: this.totjab[i] })
                    }
                for (let i = 0; i < this.subsub.length; i++) {
                        Object.assign(this.detailgajipeg[i], { subsub: this.subsub[i] })
                    }        
    

            })
        },
         closeriwayat() {
            this.form.reset();
            $("#detriwayat").modal("hide");
        },
         getriwayatdetail(id){
            $('#detriwayat').modal('show')
            axios.get('/api/detriwayatgaji/'+id,{
                headers: { Authorization: "Bearer " + this.token }
            }).then((response) => {
                this.detriwayat = response.data.data
                //ssds
                this.detritun = response.data.tunjangan
                this.detrinomtun = response.data.nomtun
                this.detribon = response.data.bonus
                this.detrinombon = response.data.nombon
                this.detripot = response.data.potongan
                this.detrinompot = response.data.nompot

                    for (let i = 0; i < this.detritun.length; i++) {
                        Object.assign(this.detriwayat[i], { detritun: this.detritun[i] })
                    }   
                    for (let i = 0; i < this.detrinomtun.length; i++) {
                        Object.assign(this.detriwayat[i], { detrinomtun: this.detrinomtun[i] })
                    }
                    for (let i = 0; i < this.detribon.length; i++) {
                        Object.assign(this.detriwayat[i], { detribon: this.detribon[i] })
                    }   
                    for (let i = 0; i < this.detrinombon.length; i++) {
                        Object.assign(this.detriwayat[i], { detrinombon: this.detrinombon[i] })
                    }    
                    for (let i = 0; i < this.detripot.length; i++) {
                        Object.assign(this.detriwayat[i], { detripot: this.detripot[i] })
                    }   
                    for (let i = 0; i < this.detrinompot.length; i++) {
                        Object.assign(this.detriwayat[i], { detrinompot: this.detrinompot[i] })
                    }        
            })
        },
        searchriwayat(val){
            if (val == "")
			   {
				   this.riwayat()
			   }else {
				   axios
					   .get('/api/searchriwayatpeg/'+ val , {
						   headers: {Authorization: "Bearer " + this.token},
					   })
					   .then((response) => {
						   this.riwayatgaji = response.data;
					   });
			   }
        }
	},
    watch: {
			search: function()
			 {
				this.searchriwayat(this.search)
			 },
		},
	mounted() {
		this.getpt();
        this.riwayat();
		this.getgaji();
		this.getJabatan();
		this.getakun();
		this.getprofile();
		document.getElementById("btnPrint").onclick = function () {
			printElement(document.getElementById("printThis"));
		}

		function printElement(elem) {
			var domClone = elem.cloneNode(true);
			
			var $printSection = document.getElementById("printSection");
			
			if (!$printSection) {
				var $printSection = document.createElement("div");
				$printSection.id = "printSection";
				document.body.appendChild($printSection);
			}
			
			$printSection.innerHTML = "";
			$printSection.appendChild(domClone);
			window.print();
		}
	},
    


}


</script>
<style>
@media screen {
  #printSection {
      display: none;
  }
}

@media print {
  body * {
    visibility:hidden;
  }
  #printSection, #printSection * {
    visibility:visible;
  }
  #printSection {
    left:0;
    top:0;
  }
}
</style>
